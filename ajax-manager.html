<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<script src="./vars.js"></script>
<!--

Shows drop down menu (works on chrome)

### Usage
The list displayed in the drop down menu can be set as an attribute.

    <drop-menu list-items='["first" ,"second"]'></drop-menu>

For an overlayed drop menu:

    <drop-menu overlay-menu list-items='["first" ,"second"]'></drop-menu>

### Styling
 Custom property | Description | Default
----------------|-------------|----------
`--item-background-color` | List item backround color | `#f1ecef`
`--item-color` | List item color used for fonts | `#302f31`
`--close-color` | Icon button hover color | `4775D1`
`--content-background` | Drop menu's background color | `white`
`--close-color` | Icon button hover color | `4775D1`
`--icon-button` | Mixin applied the icon button | `{}`

@demo demo/drop-menu-demo.html
-->
<dom-module id="ajax-manager">
    <template>
        <style></style>
        <iron-ajax id="ajax" url="/data/{{request}}.json" handle-as="json" last-response="{{response}}" loading="{{loading}}" on-response="_didRespond"></iron-ajax>
        <iron-localstorage name="{{request}}" value="{{response}}" on-iron-localstorage-load-empty="_initializeDefaultResponse"></iron-localstorage>
    </template>
    <script>
        Polymer({
            is: "ajax-manager",
            observers: [],
            behaviors: [],
            listeners: {},
            properties: {
                request:{
                    type:String,
                    observer:'update'
                },
                response: {
                    type: Object,
                    notify: true
                },
                loading: {
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },
            _initializeDefaultResponse: function () {
                this.response = {list:[]};
            },
            _didRespond: function (e) {
                this.loading = false;
            },
            update: function () {
                if (this.request !== undefined && this.request !== "") {
                    if (JSONResults[this.request] === undefined) {
                        JSONResults[this.request] = "requesting";
                        this.loading = true;
                        this.$.ajax.generateRequest();
                    }
                }
            },
            ready: function () {
                Polymer.RenderStatus.afterNextRender(this, function () {
                    this.update();
                });
            }
        });
    </script>
</dom-module>
